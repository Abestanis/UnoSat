/** Functionality to parse incoming messages. */
// *** AUTOGENERATED FILE - Do not edit manually! - Changes will be overwritten! *** //

#pragma once

#include <stddef.h>
#include "generated/units.h"
#include "generated/sharedTypes.h"
#include "generated/bufferAccessor.h"

#ifdef __cplusplus
extern "C" {
#endif

/** An error during parsing of a message. */
typedef enum {
    /** The message type was not recognized. */
    INVALID_MESSAGE,

    /** The checksum of the message was invalid. */
    CHECKSUM_ERROR,

    /** A dynamic size was too large. */
    DYNAMIC_SIZE_TOO_LARGE,
} ParserError;


/** A handler of parsed messages. */
typedef struct MessageHandler {
    /**
     * Handle a DATA message.
     *
     * @param handler The message handler.
     * @param time The CPU time this telemetry was generated.
     * @param temperature The temperature.
     * @param humidity The air humidity.
     * @param pressure The air pressure.
     */
    void (*handleMessageData)(struct MessageHandler* handler, ms_t time, celsius_t temperature,
        percent_t humidity, pascal_t pressure);

    /**
     * Handle a LOG message.
     *
     * @param handler The message handler.
     * @param time The CPU time this message was generated.
     * @param level The severity of this message.
     * @param size The size of the message in bytes.
     * @param message The message text.
     */
    void (*handleMessageLog)(struct MessageHandler* handler, ms_t time, LogLevel level,
        uint16_t size, const char* message);

    /**
     * Handle an error during parsing of a message.
     *
     * @param handler The message handler.
     * @param error The error that occurred.
     */
    void (*errorHandler)(struct MessageHandler* handler, ParserError error);

    /** Private data of the message handler. */
    void* data;
} MessageHandler;


/**
 * Parse and handle a received message.
 *
 * @param buffer An accessor to a buffer to parse a message from.
 * @param handler An handler for parsed messages.
 * @return Whether the message was parsed and handled.
 */
extern bool parseMessage(BufferAccessor* buffer, MessageHandler* handler);

#ifdef __cplusplus
}
#endif
