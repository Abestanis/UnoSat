/** Functionality to parse incoming messages. */
// *** AUTOGENERATED FILE - Do not edit manually! - Changes will be overwritten! *** //

#pragma once

#include <stddef.h>
#include "generated/units.h"
#include "generated/sharedTypes.h"
#include "generated/bufferAccessor.h"

#ifdef __cplusplus
extern "C" {
#endif

typedef enum {
    INVALID_MESSAGE,
    CHECKSUM_ERROR,
    DYNAMIC_SIZE_TOO_LARGE,
} ParserError;


typedef struct MessageHandler {

    /**
     * Handle a DATA message.
     * 
     * @param handler The message handler.
     * @param time The CPU time this telemetry was generated.
     * @param latitude The last known latitude of the system.
     * @param longitude The last known longitude of the system.
     * @param attitude The last known attitude of the system.
     * @param visibleSatellites The number of visible satellites.
     * @param temperature The temperature.
     * @param humidity The air humidity.
     * @param pressure The air pressure.
     */
    void (* handleMessageData)(struct MessageHandler* handler, ms_t time, deg_t latitude, deg_t longitude, mm_t attitude, uint8_t visibleSatellites, celsius_t temperature, percent_t humidity, pascal_t pressure);

    /**
     * Handle a LOG message.
     * 
     * @param handler The message handler.
     * @param time The CPU time this message was generated.
     * @param level The severity of this message.
     * @param size The size of the message in bytes.
     * @param message The message text.
     */
    void (* handleMessageLog)(struct MessageHandler* handler, ms_t time, LogLevel level, uint16_t size, const char* message);

    void (* errorHandler)(struct MessageHandler* handler, ParserError error);

    void* data;
} MessageHandler;


/**
 * Parse and handle a received message.
 *
 * @param buffer An accessor to a buffer to parse a message from.
 * @param handler An handler for parsed messages.
 * @return Whether the message was parsed and handled.
 */
extern bool parseMessage(BufferAccessor* buffer, MessageHandler* handler);

#ifdef __cplusplus
}
#endif
